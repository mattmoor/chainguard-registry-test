name: Publish

on:
  push:
    branches: ['main']

jobs:
  publish:
    name: Publish

    # https://docs.github.com/en/actions/reference/authentication-in-a-workflow
    permissions:
      id-token: write
      packages: write
      contents: read

    runs-on: ubuntu-latest
    steps:
    - uses: actions/setup-go@v2
      with:
        go-version: 1.18
    - uses: actions/checkout@v2

    - uses: mattmoor/actions-1/setup-chainctl@identity-actions
      with:
        environment: chainops.dev
        identity: a06277b3fbd9a0fbd522c3e66e0543cc96ff0932/4302ec17e3156f77

    - uses: ko-build/setup-ko@v0.6
    - env:
        KO_DOCKER_REPO: tmp.chainreg.biz/a06277b3fbd9a0fbd522c3e66e0543cc96ff0932
      run: ko build --tags yolo --bare
